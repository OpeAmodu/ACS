---
title: "Socioeconomic and Socio-demographic patterns in smoking cessation behavior in the United States"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  pdf_document:
    toc: TRUE
    toc_depth: 3
    number_sections: TRUE
    highlight: tango
    citation_package: natbib
fontsize: 12pt
urlcolor: blue
---

```{=tex}
\newpage
\tableofcontents
\listoftables
\newpage
```
```{r setup, include=FALSE, warning = FALSE}
knitr::opts_chunk$set(cache=FALSE, warning=FALSE, message=FALSE, echo=FALSE, knitr.table.format="latex",
                      fig.post="p", out.width="100%", dpi=300)
```

# Methods

## Variable Selection and Summary Statistics

### *Installing R and Dependent packages*

Analyses was done using R version 4.0.4 (2021-02-15) -- "Lost Library Book" Copyright (C) 2021 and Rstudio Version 1.4.1106 Â© 2009-2021 RStudio, PBC. Installers and instructions for R can be found at the [cran website link](https://cran.rstudio.com/). To install Rstudio, please click this [R studio link](https://rstudio.com/products/rstudio/download/). Analyses depends on installing the latest version of the following R packages:

-   tidyverse; This package helps for wrangling data and working easily with data tables. Installing the tidyverse would avoid installing sub-packages like ggplot(for visualization), dplyr(wrangling data, sql/table joining competencies) and others
-   survey; This package helps with working with survey data.
-   knitr: In this analysis, knitr was used to make reports in HTML and pdf format. knitr can help with create slides, word documents and others if needed. 
-   lubridate: lubridate package helps with formatting dates to human readable format. In the analysis, the lubridate package was used to extract the dates smoking quitters actually quit smoking.
-   broom: broom makes models cleaner and more human readable and tidy. I used broom in some cases to report coefficients of regression models.
- kableExtra: for designing good looking tables

To read the full documentations of any package please type *?packagename* to your R or R studio console. Run the code below on R or R studio to install needed packages;

```{r, echo=TRUE}
# To install needed Libraries, please run the following code in R or Rstudio
installed_pkgs <- row.names(installed.packages())
pkgs <- c("tidverse", "survey", "knitr", "lubridate", "broom", "kableExtra")
for(p in pkgs){
if(!(p %in% installed_pkgs)){
install.packages(p, repos = "http://cran.us.r-project.org")
}
}

```

```{r, message = FALSE, warning = FALSE}
library(tidyverse) #data wrangling, analysis and visualization
library(survey) #library for working with survey data
library(knitr) #library for kniting code and documents into HMTL, PDF, slides e.t.c.
library(lubridate) #library for working with or coercing dates 
                    #(used in this document to track date of quit)
library(broom)
library(kableExtra)
```

```{r}
nhis18_modelling <- read.csv("nhis18_modelling.csv")
nhis18_modelling <- nhis18_modelling%>%
  select(HHX, PPSU, PSTRAT, WTFA_SA, YEAR, MONTH, DAY,
         REGION, AGE, SEX, RACE,
         EDUCATION, `INCOME RATIO TO FPL`=INCOME.RATIO.TO.FPL, 
         `SEXUAL ORIENTATION`=SEXUAL.ORIENTATION, DEPEV_A, ANXEV_A,
         `MENTAL HEALTH PROBLEM`=MENTAL.HEALTH.PROBLEM, HOUSEOWN,
         `INCOME GROUP`=INCOME.GROUP, FM_SIZE, 
         `FOOD SECURITY`=FOOD.SECURITY,
         COVERAGE,
         CIGQTYR, SMKSTAT2,
         SMKQTNO, SMKQTTP, SMKQTY, DATE_INTERVIEW, QUIT_DAY,
         QUIT_MONTHS, QUIT_TYPE, DATE_QUIT_SMOKING, QUIT_SMOKING_YEAR)
#converting variables to factors
nhis18_modelling$REGION <- factor(nhis18_modelling$REGION)
nhis18_modelling$AGE <- factor(nhis18_modelling$AGE,
                                      levels = c("25-44","45-64","65+"))
nhis18_modelling$SEX <- factor(nhis18_modelling$SEX)
nhis18_modelling$RACE <- factor(nhis18_modelling$RACE, 
                                    levels = c("White","Black/African American",
                                               "Other"))
nhis18_modelling$EDUCATION <- factor(nhis18_modelling$EDUCATION,
                                 levels = c("<HS Grad", "HS Grad",
                                            "<College Grad", "College Grad+"))
nhis18_modelling$`INCOME RATIO TO FPL` <- factor(nhis18_modelling$`INCOME RATIO TO FPL`, 
                                         levels = c("<100%", "100 - 200 %", 
                                                    "200 - 400 %", ">400%"))
nhis18_modelling$`SEXUAL ORIENTATION` <- factor(nhis18_modelling$`SEXUAL ORIENTATION`, 
                                    levels = c("Straight", "Gay/Lesbian", "Other"))
nhis18_modelling$`MENTAL HEALTH PROBLEM` <- factor(nhis18_modelling$`MENTAL HEALTH PROBLEM`,
                                                 levels = c("No","Yes"))
nhis18_modelling$HOUSEOWN <- factor(nhis18_modelling$HOUSEOWN)
nhis18_modelling$`FOOD SECURITY` <- factor(nhis18_modelling$`FOOD SECURITY`, 
                                         levels = c("High", "Low"))
nhis18_modelling$`INCOME GROUP` <- factor(nhis18_modelling$`INCOME GROUP`, 
                                   levels = c("$0-34,999", "$35,000 - 74,999", 
                                              "$75,000 - 99,999", "$100,000 and over"))
nhis18_modelling$COVERAGE <- factor(nhis18_modelling$COVERAGE,
                                    levels = c("Private", "Medicaid (includes dual eligibles)",
                                               "Medicare Only", "Other Coverage", "Uninsured"))
```

### *Selecting and Merging Data Sets*

The aim of this analysis is to investigate socio-economic and socio-demographic indicators of smoking cessation in the United States. To achieve this, we used cross-sectional survey data from the National Health Interview Statistics(NHIS) for the year 2018. The NHIS collects health related survey data from households in the United States. The data and documentation can be found [here](https://www.cdc.gov/nchs/nhis/nhis_2018_data_release.htm). We extracted possible socio-economic and socio-demographic variables from Household, Family, Person and Adult data files. The household data variables was merged with the family data variables using the "SRVY_YR" and "HHX" columns. The resulting data set was merged with the adult data variables using "SRVY_YR", "HHX" and "FMX" columns. Finally, we merged the resulting data set with the person data variables using "SRVY_YR", "HHX", "FMX" and "FPX" columns. It is important to follow the sequence of these joins to produce an optimal data set. The final merged data set had 75 variables and 25417 observations.

For regression modeling, we excluded observations where age was less than 25 years old. Also, we only included observations where the respondents identified as former or current smokers. The resulting data set had `r nrow(nhis18_modelling)` observations after adjusting for age and smoking status.

### *Survey design using survey weights*

To make our analysis representative of the United States population, we created a survey design as specified by NHIS to account for sampling weights and stratification.

```{r, echo = TRUE}

nhis18_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
                           weights = ~WTFA_SA, data = nhis18_modelling)
```

### *Socio-demographic variables*

We included the following socio-demographic indicators in our analysis; Region, Gender, Age group, Race group, Sexual Orientation and Mental Health. Each individual in our sample self reported their age in years. We grouped the self reported age in 3 categories;25-44, 45-65, 65 and older. The Region variable indicated what region in the United States each person resides. Participants came from the Midwest, Northeast, South or West Region.

Each person stated what best describes their sexual orientation. Participants identified as Gay/Lesbian, Straight, Bisexual or Something else.  Individuals who identified as straight formed a group and individuals with other sexual identities were grouped as "Others". Racial identity was classified as "White", "Black/African American" and "Other". "Other" covered Asian, Alaskan and Indian American, Hispanic and Multiple races.

We used depression and anxiety status to determine mental health. Participants were asked if they were depressed daily, weekly, monthly, a few times a year or Never. The same question was asked about anxiety. In our analysis, a person has a mental health problem if they affirmed to having depression or anxiety daily, weekly or monthly.

### *Socio-economic variables*

In the NHIS survey, each person was asked about their highest level of education. Answers ranged from "Never attended/kindergarten only" to "Doctoral degree". We classified educational level as "\<HS Grad" if the person attained lower than an high school education, "HS Grad" if the person graduated from high school or passed the GED, "\<College Grad" if a person attended some college but did not attain a degree, and "College Grad+" if the person has a college diploma or higher.

NHIS survey collected data on the ratio of family income to Federal poverty level(FPL) for each individual.The ratio ranged from less than 0.50 to 5.0 and over. We classified individuals into 4 groups based on their ratio of family income to FPL;"\<100%" for ratio of 1.0 or less, "100 - 200%" for ratios between 1.0 and 2.0, "200 - 400%" for ratios between 2.0 and 4.0, and "\>400%" for ratio above 4.0. We also classified individuals based on their family income. We grouped family income as "\$0 - \$34,999", "\$35,000 - \$74,999", "\$75,000 - \$99,999" and "\$100,000 and over".

We used House ownership as a proxy for wealth. We classified house ownership as "Yes" if the participant stated that they owned or bought the house they currently live and "No" if the house was rented or other arrangements were made.

Each person was asked 10 questions about their food security. For each question, answers of "often true", "sometimes true" and "yes" was considered as an affirmation for having food security challenges. The total affirmative answers was used to create a food security score. In our model, a person's food security is low if they scored at least 3, and high if they scored less than 3. 

### *Outcome Variables*
Our first outcome of interest was smoking quit rates. Quit rate is defined as the number of people who quit smoking per total number of people in our sample. In the NHIS survey , a current or former smoker is a person who reports smoking at least a 100 cigarettes in their lifetime. This person is further asked if they now smoked cigarettes everyday, some days or not at all. A "current everyday smoker" is a person who has smoked at least a 100 cigarettes in their lifetime and still smokes everyday. A "current some day smoker" is a person who has smoked at least a 100 cigarettes in their life time and still smokes on some days. A "former smoker" is a person who has smoked a 100 cigarettes in their life time but does not smoke anymore. Former smokers were asked to report how long it has been since they quit smoking. Answers were reported in days, weeks, months and year(s) time period and the "number of units" for each time period. We use the time period and units to calculate the days since quit smoking, then we converted the days to months. For example, if a person reports that they quit smoking for weeks and the number of units is 3, then the person has quit smoking for 3 weeks or approximately a month. In our analysis, current smokers are current everyday and current someday smokers.  

We looked at quit rate outcomes for different time periods; at less than a year (11 months and below), at least 6 months and at least a year (12 months and above). For each quit time period, we created smaller data sets that were a subset of our original data set. For quitting less than a year, we excluded those that quit smoking for more than a year. For quitting at least 6 months, we excluded those that quit smoking for less than 6 months. Finally, for quitting for at least a year, we excluded those who quit smoking for less than a year. 

Our second outcome of interest was attempt to quit smoking. Each adult was asked "In the past 12 months, have you stopped smoking for more than one day because you were trying to quit smoking?". A person has attempted to quit smoking if they answered "Yes".  

```{r, include=FALSE}
str(nhis18_modelling)
```

```{r, include=FALSE}
#The table below shows the top 10 years that people in this data set quit smoking.
top_quit_years <- nhis18_modelling %>%
  select(`Year of Quit` = QUIT_SMOKING_YEAR) %>%
  group_by(`Year of Quit`)%>%
  summarize(Quits = n())%>%
  arrange(desc(Quits))%>%
  filter(!is.na(`Year of Quit`))
kable(head(top_quit_years, 10), caption="Top 10 years people quit smoking")
```

\newpage
```{r}
freq_table_function <- function(my_data, a_var){
    summary_table <- my_data %>%
    filter(!is.na({{a_var}}))%>%
    group_by({{a_var}})%>%
    summarize(Freq = n())%>%
    mutate(`%` = round(Freq/sum(Freq) * 100, 1))%>%
    select(`_`={{a_var}}, Freq, `%`)
    #kable(summary_table, caption = label)
}

education <- freq_table_function(nhis18_modelling, EDUCATION)

sex <- freq_table_function(nhis18_modelling, SEX)

region <- freq_table_function(nhis18_modelling, REGION)

age <- freq_table_function(nhis18_modelling, AGE)

race <- freq_table_function(nhis18_modelling, RACE)

rat_cat <- freq_table_function(nhis18_modelling, `INCOME RATIO TO FPL`)

orient <- freq_table_function(nhis18_modelling, `SEXUAL ORIENTATION`)

mental_health <- freq_table_function(nhis18_modelling, `MENTAL HEALTH PROBLEM`)

houseown <- freq_table_function(nhis18_modelling, HOUSEOWN)

food_sec <- freq_table_function(nhis18_modelling, `FOOD SECURITY`)

inc_grp <- freq_table_function(nhis18_modelling, `INCOME GROUP`)

coverage <- freq_table_function(nhis18_modelling, COVERAGE)

summary_table <- rbind(education, sex, region, age, race, rat_cat, orient, mental_health, houseown, food_sec, inc_grp, coverage)
kable(summary_table, caption="Summary statistics of study sample", booktabs=TRUE)%>%
  pack_rows(index = c("Education" = 4, "Sex" = 2, "Region" = 4, "Age" = 3, "Race"= 3, "Ratio of Income to FPL" = 4, 
                      "sexual orientation" = 2, "Mental Health Problem" = 2, "House Ownership" = 2, "Food Security" = 2,
                      "Income Group" = 4, "Health insurance coverage" = 5))%>%
  kable_styling(latex_options=c("striped", "hold_position"), full_width=T, font_size = 9)
```

```{r, include=FALSE}
#Data set for all quit and current smokers
all_smoke_quit <- nhis18_modelling
all_smoke_quit$QUIT_STATUS <- ifelse(all_smoke_quit$QUIT_TYPE == 1, 0, 1)

#non_weighted frequency
kable(table(all_smoke_quit$QUIT_STATUS))

#in percentage
my_table = as.table(table(all_smoke_quit$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))
```

```{r, include=FALSE}
#Data set for quit less than 6 months
smoke_quit_less6months <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE ==1| 
                                   nhis18_modelling$QUIT_TYPE == 2)

smoke_quit_less6months$QUIT_STATUS <- ifelse(smoke_quit_less6months$QUIT_TYPE == 1, 0, 1)

#creating survey design
less6months_design  <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
                           weights = ~WTFA_SA, data = smoke_quit_less6months)
#non_weighted frequency
kable(table(smoke_quit_less6months$QUIT_STATUS))

#in percentage
my_table = as.table(table(smoke_quit_less6months$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))
```

```{r, include=FALSE}
#Data set for quit between 6 and 12 months
smoke_quit_6to12months <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE ==1| 
                                   nhis18_modelling$QUIT_TYPE == 3)
smoke_quit_6to12months$QUIT_STATUS <- ifelse(smoke_quit_6to12months$QUIT_TYPE == 1, 0, 1)

#creating survey design
sixto12quit_design  <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
                           weights = ~WTFA_SA, data = smoke_quit_6to12months)
#non_weighted frequency
kable(table(smoke_quit_6to12months$QUIT_STATUS))

#in percentage
my_table = as.table(table(smoke_quit_6to12months$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))

```

```{r, include=FALSE}
###data set for quit less than a year
smoke_quit_lessthanyear <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE == 1|
                                    nhis18_modelling$QUIT_TYPE == 2|
                                    nhis18_modelling$QUIT_TYPE == 3)
smoke_quit_lessthanyear$QUIT_STATUS <- ifelse(smoke_quit_lessthanyear$QUIT_TYPE == 2|
                                                smoke_quit_lessthanyear$QUIT_TYPE == 3, 1, 0)

#creating survey design
lessthanyear_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE, 
                                 weights = ~WTFA_SA, data = smoke_quit_lessthanyear)
#non_weighted frequency
kable(table(smoke_quit_lessthanyear$QUIT_STATUS))

#In percentage
my_table = as.table(table(smoke_quit_lessthanyear$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))
```

```{r, include=FALSE}
###data set for quit at least 6 months
quit_6month_and_over <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE == 1|
                                 nhis18_modelling$QUIT_TYPE == 3|
                                 nhis18_modelling$QUIT_TYPE == 4)
quit_6month_and_over$QUIT_STATUS <- ifelse(quit_6month_and_over$QUIT_TYPE == 1, 0, 1)

#creating survey design
quit_6month_and_over_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
                                         weights = ~WTFA_SA, 
                                         data = quit_6month_and_over)

#non_weighted frequency
kable(table(quit_6month_and_over$QUIT_STATUS))

#in percentage
my_table = as.table(table(quit_6month_and_over$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))
```

```{r, include=FALSE}
###data set for quit at least a year
smoke_quit_yearandover <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE ==1| 
                                   nhis18_modelling$QUIT_TYPE == 4)

smoke_quit_yearandover$QUIT_STATUS <- ifelse(smoke_quit_yearandover$QUIT_TYPE == 1, 0, 1)

#creating survey design
yearandover_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
                           weights = ~WTFA_SA, data = smoke_quit_yearandover)
#non_weighted frequency
kable(table(smoke_quit_yearandover$QUIT_STATUS))

#in percentage
my_table = as.table(table(smoke_quit_yearandover$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))
```

```{r, include=FALSE}
###data set for attempt to quit smoking
#Note that the CIGQTYR variable records people that attempt to quit smoking within the last 12 months.
#We are sub-setting for only current smokers. 
attempt_to_quit <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE == 1)

#creating survey design
attempt_to_quit_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE, 
                                 weights = ~WTFA_SA, data = attempt_to_quit)
# non_weighted frequency
kable(table(attempt_to_quit$CIGQTYR))

#in percentage
my_table = as.table(table(attempt_to_quit$CIGQTYR))
kable(round(prop.table(my_table) * 100, 2))
```

\newpage

## Statistical Analysis

The following multiple logistic regression formula  was used to assess the relationship between socio-economic and socio-demographic indicators on quit outcomes. 
$$
P(Y=1|X=x) = \frac{exp(\beta_{o} + \beta_{1}X_{1} + \beta_{2}X_{2} + ...+\beta_{n}X_{n})}
{1 + exp(\beta_{o} + \beta_{1}X_{1} + \beta_{2}X_{2} + ...+\beta_{n}X_{n})}
$$
X represents our independent variables(socio-economic and socio-demographic variables). Independent variables include Region, Age, Education, Income Ratio to FPL, sexual orientation, mental health problems, Race, House ownership, Family Income and Food security. We created a vector of dummies for each independent variable. We studied 4 smoking related quit outcomes; probability of quitting for less than a year, probability of quitting for at least 6 months, probability of quitting for at least a year, and the probability of attempting to quit smoking. For the first 3 outcomes, Y takes the value of "1" if a person quits smoking and the value of "0" if a person does not quit smoking in the different time periods. For attempt to quit smoking, Y takes the value of "1" if a person attempts to quit smoking for more than one day in the last year and "0" otherwise. 

We estimated the adjusted odds ratio with a 95% confidence interval for quitting and attempts to quit for each comparison of our independent variables. For example, we estimated the odds of quitting smoking when food security is low compared versus high. All estimates in our analysis was weighted using NHIS recommendations as described earlier. Statistical significance was tested at a p-value of 0.1. The resulting model was used to estimate Adjusted Quit rates and Adjusted Quit attempts with a 95% confidence interval. 


```{r}
### function calculated unadjusted and adjusted quit rates
readjust_function <- function(dframe1, dframe2, a_var, label){
  dframe1$QUIT_STATUS <- as.character(dframe1$QUIT_STATUS)
  dframe1 <- dframe1 %>%
    select({{a_var}}, QUIT_STATUS)
  dframe1 <- na.omit(dframe1)
    
  unadjusted_quit <- dframe1%>%
    group_by({{a_var}}, QUIT_STATUS)%>%
    summarize(QUIT_RATE = n())%>%
    spread(QUIT_STATUS, QUIT_RATE)%>%
    mutate(`Unadjusted Quit Rate` = round((`1`)/(`1` + `0`) * 100, 1))
  unadjusted_quit$prob <- unadjusted_quit$`Unadjusted Quit Rate`/100
  unadjusted_quit$n <- unadjusted_quit$`1` + unadjusted_quit$`0`
  unadjusted_quit$se <- sqrt((unadjusted_quit$prob * (1-unadjusted_quit$prob))/unadjusted_quit$n)
  unadjusted_quit$lower <- round((unadjusted_quit$prob - (qnorm(0.975) * unadjusted_quit$se)) * 100, 1)
  unadjusted_quit$upper <- round((unadjusted_quit$prob + (qnorm(0.975) * unadjusted_quit$se)) * 100, 1)
  unadjusted_quit$`Unadjusted Quit Rate (%)` <- paste(unadjusted_quit$`Unadjusted Quit Rate`, 
                                                  "(", unadjusted_quit$lower, "-", unadjusted_quit$upper, ")") 
  unadjusted_quit <-unadjusted_quit%>%
    select(`-`={{a_var}}, `Unadjusted Quit Rate (%)`)
  
  
  
  adjusted_quit <- dframe2 %>%
    group_by({{a_var}})%>%
    summarize_at(vars(`Adjusted Quit Rate`, lower_bound, upper_bound), mean)%>%
    transmute(`Adjusted Quit Rate`=round(`Adjusted Quit Rate` * 100, 1),
              lower_bound=round(lower_bound * 100, 1), 
              upper_bound=round(upper_bound * 100,1))
  adjusted_quit$concat <- paste(adjusted_quit$`Adjusted Quit Rate`, "(", adjusted_quit$lower_bound, "-" , adjusted_quit$upper_bound, ")")
  adjusted_quit <- adjusted_quit %>%
    select(`Adjusted Quit Rate (%)` = concat)
  
  tabulate <- cbind(unadjusted_quit, adjusted_quit)
  
}

#general quit function 
general_quit_function <- function(dframe1, dframe2){
  dframe1$QUIT_STATUS <- as.character(dframe1$QUIT_STATUS)
  dframe1$General_Quit <- "Total"
  dframe1 <- dframe1 %>%
  select(General_Quit, QUIT_STATUS)
  dframe1 <- na.omit(dframe1)
  
  
  general_quit <- dframe1%>%
    group_by(General_Quit, QUIT_STATUS)%>%
    summarize(QUIT_RATE = n())%>%
    spread(QUIT_STATUS, QUIT_RATE)%>%
    mutate(`Unadjusted Quit Rate` = round((`1`)/(`1` + `0`) * 100, 1))
  general_quit$prob <- general_quit$`Unadjusted Quit Rate`/100
  general_quit$n <- general_quit$`1` + general_quit$`0`
  general_quit$se <- sqrt((general_quit$prob * (1-general_quit$prob))/general_quit$n)
  general_quit$lower <- round((general_quit$prob - (qnorm(0.975) * general_quit$se)) * 100, 1)
  general_quit$upper <- round((general_quit$prob + (qnorm(0.975) * general_quit$se)) * 100, 1)
  general_quit$`Unadjusted Quit Rate (%)` <- paste(general_quit$`Unadjusted Quit Rate`, 
                                                  "(", general_quit$lower, "-", general_quit$upper, ")")
  general_quit <- general_quit%>%
    select(`-`= General_Quit, `Unadjusted Quit Rate (%)`)
  
  general_quit2 <- dframe2 %>%
    summarize_at(vars(`Adjusted Quit Rate`, lower_bound, upper_bound), mean)%>%
    transmute(`Adjusted Quit Rate`=round(`Adjusted Quit Rate` * 100, 1),
              lower_bound=round(lower_bound * 100, 1), 
              upper_bound=round(upper_bound * 100,1))
  general_quit2$concat <- paste(general_quit2$`Adjusted Quit Rate`, "(", general_quit2$lower_bound, "-" , general_quit2$upper_bound, ")")
  general_quit2 <- general_quit2 %>%
    select(`Adjusted Quit Rate (%)` = concat)
    
  tabulate1 <- cbind(general_quit, general_quit2)
  tabulate1
}
```


\newpage

# Results

## Recent Successful Cessation
We defined a recent successful cessation as a person who smoked in the past year but has quit smoking for at least 6 months in the past year. The denominator includes all recent successful quits and current smokers. Generally, recent successful cessation rate was 6.4% (table 3). As education level increased, the recent successful cessation increased ranging from 3.4% among those with less than an High school degree to 12.1% among those with at least a college degree. Black people were less successful at recent cessation (4.7%) compared to white people (6.6%). People with higher income had more success at smoking cessation than people who had lower income (table 3). Uninsured people had the second lowest recent cessation rate (4.6%) and, people with private insurance had the highest (8.2%). Medicaid patients had the second lowest recent cessation rate (3.4%).

\newpage

```{r}
# Quit smoke for less than a year
vars <- c("AGE", "SEX", "EDUCATION", "INCOME RATIO TO FPL", "SEXUAL ORIENTATION", "MENTAL HEALTH PROBLEM",
         "RACE", "HOUSEOWN", "INCOME GROUP", "FOOD SECURITY", "COVERAGE")

reg1_quit_lessthanyear <- smoke_quit_6to12months %>%
                          drop_na(REGION, any_of(vars))

reg1 <- svyglm(formula = QUIT_STATUS ~ REGION + AGE + SEX +
                 EDUCATION + `INCOME RATIO TO FPL`+ 
                 `SEXUAL ORIENTATION` + `MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN + 
                 `INCOME GROUP` + `FOOD SECURITY` + COVERAGE, 
               design = sixto12quit_design, 
               family = quasibinomial,
               data = smoke_quit_6to12months,
 
                             na.action = na.omit)

```

```{r}
#summary(reg1)
summary <- tidy(reg1, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
  select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Quit Smoking less than a Year", booktabs=T, digits=3, linesep="\\addlinespace",
      longtable=T, align="crrr")%>%
  kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 8.5)%>%
  row_spec(c(5, 7, 10, 15), color='red')%>%
  footnote(number=c("Variables colored red are statistically significant at alpha <= 0.1"))
```

\newpage
```{r}
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg1), confint(reg1))), digits=3, booktabs=T)
#fitting model to data
predicted_quit <- 
    cbind(reg1_quit_lessthanyear,
          as.data.frame(
            predict(
              reg1,
              reg1_quit_lessthanyear,
              type = "response", 
              se.fit=TRUE
              )))
predicted_quit$`Adjusted Quit Rate` <- predicted_quit$response
predicted_quit$lower_bound <- predicted_quit$`Adjusted Quit Rate` - (qnorm(0.975)*predicted_quit$SE)
predicted_quit$upper_bound <- predicted_quit$`Adjusted Quit Rate` + (qnorm(0.975)*predicted_quit$SE)


#smoke_quit_lessthanyear$QUIT_STATUS <- as.character(smoke_quit_lessthanyear$QUIT_STATUS)
#unadjusted_quit <- smoke_quit_lessthanyear %>%
  #select(REGION, QUIT_STATUS)%>%
  #group_by(REGION, QUIT_STATUS)%>%
  #summarize(QUIT_RATE = n())%>%
  #spread(QUIT_STATUS, QUIT_RATE)%>%
  #transmute(`Unadjusted Quit Rate` = round((`1`)/(`1` + `0`) * 100, 1))

#adjusted_quit <- predicted_quit %>%
  #group_by(REGION)%>%
  #summarize(`Adjusted Quit Rate` = round(mean(adjusted_quit_status) * 100, 1))%>%
  #select(`Adjusted Quit Rate`)

#tabe_final <- cbind(unadjusted_quit, adjusted_quit)
#kable(tabe_final, caption="Unadjusted and Adjusted Quit Rate by Region")

```

```{r}
general_quit <- general_quit_function(smoke_quit_6to12months, predicted_quit)
region <- readjust_function(smoke_quit_6to12months, predicted_quit, REGION)
age <- readjust_function(smoke_quit_6to12months, predicted_quit, AGE)
sex <- readjust_function(smoke_quit_6to12months, predicted_quit, SEX)
education <- readjust_function(smoke_quit_6to12months, predicted_quit, EDUCATION)
ratcat <- readjust_function(smoke_quit_6to12months, predicted_quit, `INCOME RATIO TO FPL`)
mental_health <- readjust_function(smoke_quit_6to12months, predicted_quit, `MENTAL HEALTH PROBLEM`)
race <- readjust_function(smoke_quit_6to12months, predicted_quit, RACE)
houseown <- readjust_function(smoke_quit_6to12months, predicted_quit, HOUSEOWN)
income <- readjust_function(smoke_quit_6to12months, predicted_quit, `INCOME GROUP`)
food_sec <- readjust_function(smoke_quit_6to12months, predicted_quit, `FOOD SECURITY`)
orient <- readjust_function(smoke_quit_6to12months, predicted_quit, `SEXUAL ORIENTATION`)
coverage <- readjust_function(smoke_quit_6to12months, predicted_quit, COVERAGE)

adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Quitting Smoking less than a year", booktabs=T, longtable=T, align = "lrr")%>%
  pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
                    "Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2, "Health insurance coverage"=5))%>%
  kable_styling(latex_options=c("striped", "hold_position", "repeat_header"), full_width=T, font_size = 9)
```

\newpage

## Quit Smoking for at least 6 months

```{r}

reg2_quit_6month_and_over <- quit_6month_and_over %>%
                          drop_na(REGION, any_of(vars))
# Quit smoke for at least a year or more
reg2 <- svyglm(formula = QUIT_STATUS ~ REGION + AGE + SEX + EDUCATION + 
                 `INCOME RATIO TO FPL`+ `SEXUAL ORIENTATION` + 
                 `MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN +
                 `INCOME GROUP` + `FOOD SECURITY` + COVERAGE, 
               design = quit_6month_and_over_design, 
               family = quasibinomial,
      data = quit_6month_and_over, na.action = na.omit)
```

```{r}
#summary(reg2)
summary <- tidy(reg2, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
  select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Quitting Smoking at least 6 months", booktabs=T, digits=3, linesep="\\addlinespace",
      longtable=T, align="crrr")%>%
  kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 8.5)%>%
  row_spec(c(4,5,6,9,10,11,12,15,16,18,20,21,22), color='red')%>%
  footnote(number=c("Variables colored red are statistically significant at alpha = 0.1"))
```

```{r}
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg2), confint(reg2))), digits=3, booktabs =T)
#fitting model to data
predicted_quit_least_6months <- 
    cbind(reg2_quit_6month_and_over,
          as.data.frame(
            predict(
              reg2,
              reg2_quit_6month_and_over,
              type = "response", 
              se.fit=TRUE
              )))
predicted_quit_least_6months$`Adjusted Quit Rate` <- predicted_quit_least_6months$response
predicted_quit_least_6months$lower_bound <- predicted_quit_least_6months$`Adjusted Quit Rate` -
                                            (qnorm(0.975)*predicted_quit_least_6months$SE)
predicted_quit_least_6months$upper_bound <- predicted_quit_least_6months$`Adjusted Quit Rate` + 
                                            (qnorm(0.975)*predicted_quit_least_6months$SE)
```

```{r}
general_quit <- general_quit_function(quit_6month_and_over, predicted_quit_least_6months)
region <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, REGION)
age <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, AGE)
sex <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, SEX)
education <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, EDUCATION)
rat_cat <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `INCOME RATIO TO FPL`)
mental_health <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `MENTAL HEALTH PROBLEM`)
race <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, RACE)
houseown <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, HOUSEOWN)
incgrp <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `INCOME GROUP`)
food_sec <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `FOOD SECURITY`)
sex_orient <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `SEXUAL ORIENTATION`)
coverage <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, COVERAGE)

adjust_table <- rbind(general_quit, region, age, sex, education, rat_cat, mental_health, race, houseown, incgrp, food_sec, sex_orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Quitting Smoking at least 6 months", booktabs=T, align="lrr")%>%
  pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
                    "Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
                    "Health insurance coverage"=5))%>%
  kable_styling(latex_options=c("hold_position","striped"), full_width=T, font_size = 9)
```

\newpage

## Quit Smoking for at least a year

```{r}
reg3_quit_yearandover <- smoke_quit_yearandover %>%
                          drop_na(REGION, any_of(vars))
# Quit smoke for at least a year or more
reg3 <- svyglm(formula = QUIT_STATUS ~ REGION + AGE + SEX + EDUCATION +
                 `INCOME RATIO TO FPL`+ `SEXUAL ORIENTATION` + 
                 `MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN + 
                 `INCOME GROUP` + `FOOD SECURITY` + COVERAGE, 
               design = yearandover_design, 
               family = quasibinomial,
      data = smoke_quit_yearandover, na.action = na.omit)

```

```{r}
#summary(reg3)
summary <- tidy(reg3, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
  select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Quitting Smoking at least a Year", booktabs=T, digits=3, linesep="\\addlinespace",
      longtable=T, align = "crrr")%>%
  kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 8.5)%>%
  row_spec(c(4,5,6,9,10,11,12,15,16,18,20,21,22), color='red')%>%
  footnote(number=c("Variables colored red are statistically significant at alpha = 0.1"))
```

```{r}
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg3), confint(reg3))), digits=3, booktabs=T)

#fitting model to data
predicted_quit_yearandover <- 
    cbind(reg3_quit_yearandover,
          as.data.frame(
            predict(
              reg3,
              reg3_quit_yearandover,
              type = "response", 
              se.fit=TRUE
              )))
predicted_quit_yearandover$`Adjusted Quit Rate` <- predicted_quit_yearandover$response
predicted_quit_yearandover$lower_bound <- predicted_quit_yearandover$`Adjusted Quit Rate` -
                                          (qnorm(0.975)*predicted_quit_yearandover$SE)
predicted_quit_yearandover$upper_bound <- predicted_quit_yearandover$`Adjusted Quit Rate` + 
                                          (qnorm(0.975)*predicted_quit_yearandover$SE)

```

```{r}
### *Un-adjusted and Adjusted Quit Rate for Quit smoking at least a year*
general_quit <- general_quit_function(smoke_quit_yearandover, predicted_quit_yearandover)
region <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, REGION)
age <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, AGE)
sex <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, SEX)
education <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, EDUCATION)
ratcat <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `INCOME RATIO TO FPL`)
mental_health <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `MENTAL HEALTH PROBLEM`)
race <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, RACE)
houseown <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, HOUSEOWN)
income <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `INCOME GROUP`)
food_sec <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `FOOD SECURITY`)
orient <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `SEXUAL ORIENTATION`)
coverage <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, COVERAGE)

adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Quitting Smoking at least a year", booktabs=T, align="lrr")%>%
  pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
                    "Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
                    "Health insurance coverage"=5))%>%
  kable_styling(latex_options=c("hold_position","striped"), full_width=T, font_size = 9)
```

\newpage

## Attempts to Quit Smoking

```{r}
reg4_attempt_to_quit <- attempt_to_quit %>%
                          drop_na(REGION, any_of(vars))
# Quit smoke for at least a year or more
reg4 <- svyglm(formula = CIGQTYR ~ REGION + AGE + SEX + EDUCATION + 
                 `INCOME RATIO TO FPL` + `SEXUAL ORIENTATION` +
                 `MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN + 
                 `INCOME GROUP` + `FOOD SECURITY` + COVERAGE, 
               design = attempt_to_quit_design, 
               family = quasibinomial,
      data = attempt_to_quit, na.action = na.omit)
```

```{r}
#summary(reg4)
summary <- tidy(reg4, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
  select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Attempt to Quit Smoking", booktabs=T, digits=3, linesep="\\addlinespace",
      longtable=T, align="crrr")%>%
  kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 8.5)%>%
  row_spec(c(4,6,9,15,16,17), color='red')%>%
  footnote(number=c("Variables colored red are statistically significant at alpha = 0.1"))
```

```{r}
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg4), confint(reg4))), digits=3, booktabs=T)

#fitting model to data
predicted_attempt_to_quit <- 
    cbind(reg4_attempt_to_quit,
          as.data.frame(
            predict(
              reg4,
              reg4_attempt_to_quit,
              type = "response", 
              se.fit=TRUE
              )))
predicted_attempt_to_quit$`Adjusted Quit Attempt` <- predicted_attempt_to_quit$response
predicted_attempt_to_quit$lower_bound <- predicted_attempt_to_quit$`Adjusted Quit Attempt` -
                                          (qnorm(0.975)*predicted_attempt_to_quit$SE)
predicted_attempt_to_quit$upper_bound <- predicted_attempt_to_quit$`Adjusted Quit Attempt` +
                                          (qnorm(0.975)*predicted_attempt_to_quit$SE)


```

```{r}
#rewriting readjust function for attempt to quit
attempt_readjust_function <- function(dframe1, dframe2, a_var, label){
  dframe1$CIGQTYR <- as.character(dframe1$CIGQTYR)
  dframe1 <- dframe1 %>%
    select({{a_var}}, CIGQTYR)
  dframe1 <- na.omit(dframe1)
  unadjusted_attempt <- dframe1%>%
    group_by({{a_var}}, CIGQTYR)%>%
    summarize(ATTEMPT_RATE = n())%>%
    spread(CIGQTYR, ATTEMPT_RATE)%>%
    mutate(`Unadjusted Quit Attempt` = round((`1`)/(`1` + `0`) * 100, 1))
  unadjusted_attempt$prob <- unadjusted_attempt$`Unadjusted Quit Attempt`/100
  unadjusted_attempt$n <- unadjusted_attempt$`1` + unadjusted_attempt$`0`
  unadjusted_attempt$se <- sqrt((unadjusted_attempt$prob * (1-unadjusted_attempt$prob))/unadjusted_attempt$n)
  unadjusted_attempt$lower <- round((unadjusted_attempt$prob - (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
  unadjusted_attempt$upper <- round((unadjusted_attempt$prob + (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
  unadjusted_attempt$`Unadjusted Quit Attempt (%)` <- paste(unadjusted_attempt$`Unadjusted Quit Attempt`, 
                                                  "(", unadjusted_attempt$lower, "-", unadjusted_attempt$upper, ")") 
  unadjusted_attempt <- unadjusted_attempt%>%
    select(`-`={{a_var}}, `Unadjusted Quit Attempt (%)`)

   adjusted_attempt <- dframe2 %>%
    group_by({{a_var}})%>%
    summarize_at(vars(`Adjusted Quit Attempt`, lower_bound, upper_bound), mean)%>%
    transmute(`Adjusted Quit Attempt`=round(`Adjusted Quit Attempt` * 100, 1),
              lower_bound=round(lower_bound * 100, 1), 
              upper_bound=round(upper_bound * 100,1))
   adjusted_attempt$concat <- paste(adjusted_attempt$`Adjusted Quit Attempt`, "(", adjusted_attempt$lower_bound, "-" , adjusted_attempt$upper_bound, ")")
   adjusted_attempt <- adjusted_attempt %>%
    select(`Adjusted Quit Attempt (%)` = concat)
  
  tabulate <- cbind(unadjusted_attempt, adjusted_attempt)
  
}

#rewriting readjust function for attempt to quit
attempt_general_function <- function(dframe1, dframe2){
  dframe1$CIGQTYR <- as.character(dframe1$CIGQTYR)
  dframe1$General_Quit <- "Total"
  dframe1 <- dframe1 %>%
    select(General_Quit, CIGQTYR)
  dframe1 <- na.omit(dframe1)
  
  unadjusted_attempt <- dframe1%>%
    group_by(General_Quit, CIGQTYR)%>%
    summarize(ATTEMPT_RATE = n())%>%
    spread(CIGQTYR, ATTEMPT_RATE)%>%
    mutate(`Unadjusted Quit Attempt` = round((`1`)/(`1` + `0`) * 100, 1))
  unadjusted_attempt$prob <- unadjusted_attempt$`Unadjusted Quit Attempt`/100
  unadjusted_attempt$n <- unadjusted_attempt$`1` + unadjusted_attempt$`0`
  unadjusted_attempt$se <- sqrt((unadjusted_attempt$prob * (1-unadjusted_attempt$prob))/unadjusted_attempt$n)
  unadjusted_attempt$lower <- round((unadjusted_attempt$prob - (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
  unadjusted_attempt$upper <- round((unadjusted_attempt$prob + (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
  unadjusted_attempt$`Unadjusted Quit Attempt (%)` <- paste(unadjusted_attempt$`Unadjusted Quit Attempt`, 
                                                  "(", unadjusted_attempt$lower, "-", unadjusted_attempt$upper, ")") 
  unadjusted_attempt <- unadjusted_attempt%>%
    select(`-`=General_Quit, `Unadjusted Quit Attempt (%)`)

   adjusted_attempt <- dframe2 %>%
    summarize_at(vars(`Adjusted Quit Attempt`, lower_bound, upper_bound), mean)%>%
    transmute(`Adjusted Quit Attempt`=round(`Adjusted Quit Attempt` * 100, 1),
              lower_bound=round(lower_bound * 100, 1), 
              upper_bound=round(upper_bound * 100,1))
   adjusted_attempt$concat <- paste(adjusted_attempt$`Adjusted Quit Attempt`, "(", adjusted_attempt$lower_bound, "-" , adjusted_attempt$upper_bound, ")")
   adjusted_attempt <- adjusted_attempt %>%
    select(`Adjusted Quit Attempt (%)` = concat)
  
  tabulate <- cbind(unadjusted_attempt, adjusted_attempt)
  
}

general_quit <- attempt_general_function(attempt_to_quit, predicted_attempt_to_quit)
region <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, REGION)
age <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, AGE)
sex <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, SEX)
education <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, EDUCATION)
ratcat <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `INCOME RATIO TO FPL`)
mental_health <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `MENTAL HEALTH PROBLEM`)
race <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, RACE)
houseown <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, HOUSEOWN)
income <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `INCOME GROUP`)
food_sec <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `FOOD SECURITY`)
orient <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `SEXUAL ORIENTATION`)
coverage <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, COVERAGE)

adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Attempt to Quit Smoking", booktabs=T, align="lrr")%>%
  pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
                    "Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
                    "Health insurance coverage"=5))%>%
  kable_styling(latex_options=c("hold_position","striped"), full_width=T, font_size = 9)
```

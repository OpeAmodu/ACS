predicted_quit$upper_bound <- predicted_quit$`Adjusted Quit Rate` + (qnorm(0.975)*predicted_quit$SE)
#smoke_quit_lessthanyear$QUIT_STATUS <- as.character(smoke_quit_lessthanyear$QUIT_STATUS)
#unadjusted_quit <- smoke_quit_lessthanyear %>%
#select(REGION, QUIT_STATUS)%>%
#group_by(REGION, QUIT_STATUS)%>%
#summarize(QUIT_RATE = n())%>%
#spread(QUIT_STATUS, QUIT_RATE)%>%
#transmute(`Unadjusted Quit Rate` = round((`1`)/(`1` + `0`) * 100, 1))
#adjusted_quit <- predicted_quit %>%
#group_by(REGION)%>%
#summarize(`Adjusted Quit Rate` = round(mean(adjusted_quit_status) * 100, 1))%>%
#select(`Adjusted Quit Rate`)
#tabe_final <- cbind(unadjusted_quit, adjusted_quit)
#kable(tabe_final, caption="Unadjusted and Adjusted Quit Rate by Region")
general_quit <- general_quit_function(smoke_quit_lessthanyear, predicted_quit)
region <- readjust_function(smoke_quit_lessthanyear, predicted_quit, REGION)
age <- readjust_function(smoke_quit_lessthanyear, predicted_quit, AGE)
sex <- readjust_function(smoke_quit_lessthanyear, predicted_quit, SEX)
education <- readjust_function(smoke_quit_lessthanyear, predicted_quit, EDUCATION)
ratcat <- readjust_function(smoke_quit_lessthanyear, predicted_quit, `INCOME RATIO TO FPL`)
mental_health <- readjust_function(smoke_quit_lessthanyear, predicted_quit, `MENTAL HEALTH PROBLEM`)
race <- readjust_function(smoke_quit_lessthanyear, predicted_quit, RACE)
houseown <- readjust_function(smoke_quit_lessthanyear, predicted_quit, HOUSEOWN)
income <- readjust_function(smoke_quit_lessthanyear, predicted_quit, `INCOME GROUP`)
food_sec <- readjust_function(smoke_quit_lessthanyear, predicted_quit, `FOOD SECURITY`)
orient <- readjust_function(smoke_quit_lessthanyear, predicted_quit, `SEXUAL ORIENTATION`)
coverage <- readjust_function(smoke_quit_lessthanyear, predicted_quit, COVERAGE)
adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Quitting Smoking less than a year", booktabs=T, longtable=T, align = "lrr")%>%
pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
"Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2, "Health insurance coverage"=5))%>%
kable_styling(latex_options=c("striped", "hold_position", "repeat_header"), full_width=T, font_size = 10)%>%
footnote(number=c("95% confidence intervals are reported in parentheses"))
# Quit smoke for at least a year or more
reg2 <- svyglm(formula = QUIT_STATUS ~ REGION + AGE + SEX + EDUCATION +
`INCOME RATIO TO FPL`+ `SEXUAL ORIENTATION` +
`MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN +
`INCOME GROUP` + `FOOD SECURITY` + COVERAGE,
design = quit_6month_and_over_design,
family = quasibinomial,
data = quit_6month_and_over, na.action = na.omit)
#summary(reg2)
summary <- tidy(reg2, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Quitting Smoking at least 6 months", booktabs=T, digits=3, linesep="\\addlinespace",
longtable=T, align="crrr")%>%
kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 9)%>%
row_spec(c(4,5,6,9,10,11,12,15,16,18,20,21,22), color='red')%>%
footnote(number=c("Variables colored red are statistically significant at alpha <= 0.1", "95% confidence intervals are reported in parentheses"))
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg2), confint(reg2))), digits=3, booktabs =T)
#fitting model to data
predicted_quit_least_6months <-
cbind(reg2_quit_6month_and_over,
as.data.frame(
predict(
reg2,
reg2_quit_6month_and_over,
type = "response",
se.fit=TRUE
)))
###data set for quit at least 6 months
quit_6month_and_over <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE == 1|
nhis18_modelling$QUIT_TYPE == 3|
nhis18_modelling$QUIT_TYPE == 4)
quit_6month_and_over$QUIT_STATUS <- ifelse(quit_6month_and_over$QUIT_TYPE == 1, 0, 1)
#creating survey design
quit_6month_and_over_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
weights = ~WTFA_SA,
data = quit_6month_and_over)
#non_weighted frequency
kable(table(quit_6month_and_over$QUIT_STATUS))
#in percentage
my_table = as.table(table(quit_6month_and_over$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))
###data set for quit at least a year
smoke_quit_yearandover <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE ==1|
nhis18_modelling$QUIT_TYPE == 4)
smoke_quit_yearandover$QUIT_STATUS <- ifelse(smoke_quit_yearandover$QUIT_TYPE == 1, 0, 1)
#creating survey design
yearandover_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
weights = ~WTFA_SA, data = smoke_quit_yearandover)
#non_weighted frequency
kable(table(smoke_quit_yearandover$QUIT_STATUS))
#in percentage
my_table = as.table(table(smoke_quit_yearandover$QUIT_STATUS))
kable(round(prop.table(my_table) * 100, 2))
attempt_to_quit <- subset(nhis18_modelling, nhis18_modelling$QUIT_TYPE == 1)
#creating survey design
attempt_to_quit_design <- svydesign(id = ~PPSU, strata = ~PSTRAT, nest = TRUE,
weights = ~WTFA_SA, data = attempt_to_quit)
# non_weighted frequency
kable(table(attempt_to_quit$CIGQTYR))
#in percentage
my_table = as.table(table(attempt_to_quit$CIGQTYR))
kable(round(prop.table(my_table) * 100, 2))
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg2), confint(reg2))), digits=3, booktabs =T)
#fitting model to data
predicted_quit_least_6months <-
cbind(reg2_quit_6month_and_over,
as.data.frame(
predict(
reg2,
reg2_quit_6month_and_over,
type = "response",
se.fit=TRUE
)))
reg2_quit_6month_and_over <- quit_6month_and_over %>%
drop_na(REGION, any_of(vars))
# Quit smoke for at least a year or more
reg2 <- svyglm(formula = QUIT_STATUS ~ REGION + AGE + SEX + EDUCATION +
`INCOME RATIO TO FPL`+ `SEXUAL ORIENTATION` +
`MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN +
`INCOME GROUP` + `FOOD SECURITY` + COVERAGE,
design = quit_6month_and_over_design,
family = quasibinomial,
data = quit_6month_and_over, na.action = na.omit)
#summary(reg2)
summary <- tidy(reg2, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Quitting Smoking at least 6 months", booktabs=T, digits=3, linesep="\\addlinespace",
longtable=T, align="crrr")%>%
kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 9)%>%
row_spec(c(4,5,6,9,10,11,12,15,16,18,20,21,22), color='red')%>%
footnote(number=c("Variables colored red are statistically significant at alpha <= 0.1", "95% confidence intervals are reported in parentheses"))
#fitting model to data
predicted_quit_least_6months <-
cbind(reg2_quit_6month_and_over,
as.data.frame(
predict(
reg2,
reg2_quit_6month_and_over,
type = "response",
se.fit=TRUE
)))
predicted_quit_least_6months$`Adjusted Quit Rate` <- predicted_quit_least_6months$response
predicted_quit_least_6months$lower_bound <- predicted_quit_least_6months$`Adjusted Quit Rate` -
(qnorm(0.975)*predicted_quit_least_6months$SE)
predicted_quit_least_6months$upper_bound <- predicted_quit_least_6months$`Adjusted Quit Rate` +
(qnorm(0.975)*predicted_quit_least_6months$SE)
general_quit <- general_quit_function(quit_6month_and_over, predicted_quit_least_6months)
region <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, REGION)
age <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, AGE)
sex <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, SEX)
education <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, EDUCATION)
rat_cat <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `INCOME RATIO TO FPL`)
mental_health <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `MENTAL HEALTH PROBLEM`)
race <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, RACE)
houseown <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, HOUSEOWN)
incgrp <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `INCOME GROUP`)
food_sec <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `FOOD SECURITY`)
sex_orient <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, `SEXUAL ORIENTATION`)
coverage <- readjust_function(quit_6month_and_over, predicted_quit_least_6months, COVERAGE)
adjust_table <- rbind(general_quit, region, age, sex, education, rat_cat, mental_health, race, houseown, incgrp, food_sec, sex_orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Quitting Smoking at least 6 months", booktabs=T, align="lrr")%>%
pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
"Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
"Health insurance coverage"=5))%>%
kable_styling(latex_options=c("striped"), full_width=T, font_size = 10)%>%
footnote(number=c("95% confidence intervals are reported in parentheses"))
reg3_quit_yearandover <- smoke_quit_yearandover %>%
drop_na(REGION, any_of(vars))
# Quit smoke for at least a year or more
reg3 <- svyglm(formula = QUIT_STATUS ~ REGION + AGE + SEX + EDUCATION +
`INCOME RATIO TO FPL`+ `SEXUAL ORIENTATION` +
`MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN +
`INCOME GROUP` + `FOOD SECURITY`,
design = yearandover_design,
family = quasibinomial,
data = smoke_quit_yearandover, na.action = na.omit)
#summary(reg3)
summary <- tidy(reg3, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Quitting Smoking at least a Year", booktabs=T, digits=3, linesep="\\addlinespace",
longtable=T, align = "crrr")%>%
kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 9)%>%
row_spec(c(4,5,6,9,10,11,12,15,16,18,20,21,22), color='red')%>%
footnote(number=c("Variables colored red are statistically significant at alpha <= 0.1", "95% confidence intervals are reported in parentheses"))
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg3), confint(reg3))), digits=3, booktabs=T)
#fitting model to data
predicted_quit_yearandover <-
cbind(reg3_quit_yearandover,
as.data.frame(
predict(
reg3,
reg3_quit_yearandover,
type = "response",
se.fit=TRUE
)))
predicted_quit_yearandover$`Adjusted Quit Rate` <- predicted_quit_yearandover$response
predicted_quit_yearandover$lower_bound <- predicted_quit_yearandover$`Adjusted Quit Rate` -
(qnorm(0.975)*predicted_quit_yearandover$SE)
predicted_quit_yearandover$upper_bound <- predicted_quit_yearandover$`Adjusted Quit Rate` +
(qnorm(0.975)*predicted_quit_yearandover$SE)
### *Un-adjusted and Adjusted Quit Rate for Quit smoking at least a year*
general_quit <- general_quit_function(smoke_quit_yearandover, predicted_quit_yearandover)
region <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, REGION)
age <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, AGE)
sex <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, SEX)
education <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, EDUCATION)
ratcat <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `INCOME RATIO TO FPL`)
mental_health <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `MENTAL HEALTH PROBLEM`)
race <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, RACE)
houseown <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, HOUSEOWN)
income <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `INCOME GROUP`)
food_sec <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `FOOD SECURITY`)
orient <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `SEXUAL ORIENTATION`)
coverage <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, COVERAGE)
adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Quitting Smoking at least a year", booktabs=T, align="lrr")%>%
pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
"Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
"Health insurance coverage"=5))%>%
kable_styling(latex_options=c("striped"), full_width=T, font_size = 10)%>%
footnote(number=c("95% confidence intervals are reported in parentheses"))
reg3_quit_yearandover <- smoke_quit_yearandover %>%
drop_na(REGION, any_of(vars))
# Quit smoke for at least a year or more
reg3 <- svyglm(formula = QUIT_STATUS ~ REGION + AGE + SEX + EDUCATION +
`INCOME RATIO TO FPL`+ `SEXUAL ORIENTATION` +
`MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN +
`INCOME GROUP` + `FOOD SECURITY` + COVERAGE,
design = yearandover_design,
family = quasibinomial,
data = smoke_quit_yearandover, na.action = na.omit)
#summary(reg3)
summary <- tidy(reg3, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Quitting Smoking at least a Year", booktabs=T, digits=3, linesep="\\addlinespace",
longtable=T, align = "crrr")%>%
kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 9)%>%
row_spec(c(4,5,6,9,10,11,12,15,16,18,20,21,22), color='red')%>%
footnote(number=c("Variables colored red are statistically significant at alpha <= 0.1", "95% confidence intervals are reported in parentheses"))
#fitting model to data
predicted_quit_yearandover <-
cbind(reg3_quit_yearandover,
as.data.frame(
predict(
reg3,
reg3_quit_yearandover,
type = "response",
se.fit=TRUE
)))
predicted_quit_yearandover$`Adjusted Quit Rate` <- predicted_quit_yearandover$response
predicted_quit_yearandover$lower_bound <- predicted_quit_yearandover$`Adjusted Quit Rate` -
(qnorm(0.975)*predicted_quit_yearandover$SE)
predicted_quit_yearandover$upper_bound <- predicted_quit_yearandover$`Adjusted Quit Rate` +
(qnorm(0.975)*predicted_quit_yearandover$SE)
### *Un-adjusted and Adjusted Quit Rate for Quit smoking at least a year*
general_quit <- general_quit_function(smoke_quit_yearandover, predicted_quit_yearandover)
region <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, REGION)
age <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, AGE)
sex <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, SEX)
education <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, EDUCATION)
ratcat <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `INCOME RATIO TO FPL`)
mental_health <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `MENTAL HEALTH PROBLEM`)
race <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, RACE)
houseown <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, HOUSEOWN)
income <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `INCOME GROUP`)
food_sec <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `FOOD SECURITY`)
orient <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, `SEXUAL ORIENTATION`)
coverage <- readjust_function(smoke_quit_yearandover, predicted_quit_yearandover, COVERAGE)
adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Quitting Smoking at least a year", booktabs=T, align="lrr")%>%
pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
"Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
"Health insurance coverage"=5))%>%
kable_styling(latex_options=c("striped"), full_width=T, font_size = 10)%>%
footnote(number=c("95% confidence intervals are reported in parentheses"))
reg4_attempt_to_quit <- attempt_to_quit %>%
drop_na(REGION, any_of(vars))
# Quit smoke for at least a year or more
reg4 <- svyglm(formula = CIGQTYR ~ REGION + AGE + SEX + EDUCATION +
`INCOME RATIO TO FPL` + `SEXUAL ORIENTATION` +
`MENTAL HEALTH PROBLEM` + RACE+ HOUSEOWN +
`INCOME GROUP` + `FOOD SECURITY` + COVERAGE,
design = attempt_to_quit_design,
family = quasibinomial,
data = attempt_to_quit, na.action = na.omit)
#summary(reg4)
summary <- tidy(reg4, conf.int=T, conf.level=0.95, exponentiate=T)
summary$estimate <- paste(round(summary$estimate,3), "(", round(summary$conf.low,3), "-", round(summary$conf.high,3), ")")
summary <- summary %>%
select(term, `Adjusted odds ratio`=estimate, statistic, `p value` =p.value)
kable(summary, caption = "Adjusted Odds Ratio estimates for Attempt to Quit Smoking", booktabs=T, digits=3, linesep="\\addlinespace",
longtable=T, align="crrr")%>%
kable_styling(latex_options =c("hold_position", "repeat_header"),full_width=T, font_size = 9)%>%
row_spec(c(4,6,9,15,16,17), color='red')%>%
footnote(number=c("Variables colored red are statistically significant at alpha <= 0.1", "95% confidence intervals are reported in parentheses"))
# exponentiation of the coefficients to odds ratio with a 95 percent confidence interval
#kable(exp(cbind(`Adjusted Odds Ratio` = coef(reg4), confint(reg4))), digits=3, booktabs=T)
#fitting model to data
predicted_attempt_to_quit <-
cbind(reg4_attempt_to_quit,
as.data.frame(
predict(
reg4,
reg4_attempt_to_quit,
type = "response",
se.fit=TRUE
)))
predicted_attempt_to_quit$`Adjusted Quit Attempt` <- predicted_attempt_to_quit$response
predicted_attempt_to_quit$lower_bound <- predicted_attempt_to_quit$`Adjusted Quit Attempt` -
(qnorm(0.975)*predicted_attempt_to_quit$SE)
predicted_attempt_to_quit$upper_bound <- predicted_attempt_to_quit$`Adjusted Quit Attempt` +
(qnorm(0.975)*predicted_attempt_to_quit$SE)
#rewriting readjust function for attempt to quit
attempt_readjust_function <- function(dframe1, dframe2, a_var, label){
dframe1$CIGQTYR <- as.character(dframe1$CIGQTYR)
dframe1 <- dframe1 %>%
select({{a_var}}, CIGQTYR)
dframe1 <- na.omit(dframe1)
unadjusted_attempt <- dframe1%>%
group_by({{a_var}}, CIGQTYR)%>%
summarize(ATTEMPT_RATE = n())%>%
spread(CIGQTYR, ATTEMPT_RATE)%>%
mutate(`Unadjusted Quit Attempt` = round((`1`)/(`1` + `0`) * 100, 1))
unadjusted_attempt$prob <- unadjusted_attempt$`Unadjusted Quit Attempt`/100
unadjusted_attempt$n <- unadjusted_attempt$`1` + unadjusted_attempt$`0`
unadjusted_attempt$se <- sqrt((unadjusted_attempt$prob * (1-unadjusted_attempt$prob))/unadjusted_attempt$n)
unadjusted_attempt$lower <- round((unadjusted_attempt$prob - (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$upper <- round((unadjusted_attempt$prob + (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$`Unadjusted Quit Attempt (%)` <- paste(unadjusted_attempt$`Unadjusted Quit Attempt`,
"(", unadjusted_attempt$lower, "-", unadjusted_attempt$upper, ")")
unadjusted_attempt <- unadjusted_attempt%>%
select(`-`={{a_var}}, `Unadjusted Quit Attempt (%)`)
adjusted_attempt <- dframe2 %>%
group_by({{a_var}})%>%
summarize_at(vars(`Adjusted Quit Attempt`, lower_bound, upper_bound), mean)%>%
transmute(`Adjusted Quit Attempt`=round(`Adjusted Quit Attempt` * 100, 1),
lower_bound=round(lower_bound * 100, 1),
upper_bound=round(upper_bound * 100,1))
adjusted_attempt$concat <- paste(adjusted_attempt$`Adjusted Quit Attempt`, "(", adjusted_attempt$lower_bound, "-" , adjusted_attempt$upper_bound, ")")
adjusted_attempt <- adjusted_attempt %>%
select(`Adjusted Quit Attempt (%)` = concat)
tabulate <- cbind(unadjusted_attempt, adjusted_attempt)
}
#rewriting readjust function for attempt to quit
attempt_general_function <- function(dframe1, dframe2){
dframe1$CIGQTYR <- as.character(dframe1$CIGQTYR)
dframe1$General_Quit <- "Total"
dframe1 <- dframe1 %>%
select(General_Quit, CIGQTYR)
dframe1 <- na.omit(dframe1)
unadjusted_attempt <- dframe1%>%
group_by(General_Quit, CIGQTYR)%>%
summarize(ATTEMPT_RATE = n())%>%
spread(CIGQTYR, ATTEMPT_RATE)%>%
mutate(`Unadjusted Quit Attempt` = round((`1`)/(`1` + `0`) * 100, 1))
unadjusted_attempt$prob <- unadjusted_attempt$`Unadjusted Quit Attempt`/100
unadjusted_attempt$n <- unadjusted_attempt$`1` + unadjusted_attempt$`0`
unadjusted_attempt$se <- sqrt((unadjusted_attempt$prob * (1-unadjusted_attempt$prob))/unadjusted_attempt$n)
unadjusted_attempt$lower <- round((unadjusted_attempt$prob - (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$upper <- round((unadjusted_attempt$prob + (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$`Unadjusted Quit Attempt (%)` <- paste(unadjusted_attempt$`Unadjusted Quit Attempt`,
"(", unadjusted_attempt$lower, "-", unadjusted_attempt$upper, ")")
unadjusted_attempt <- unadjusted_attempt%>%
select(`-`=General_Quit, `Unadjusted Quit Attempt (%)`)
adjusted_attempt <- dframe2 %>%
summarize_at(vars(`Adjusted Quit Attempt`, lower_bound, upper_bound), mean)%>%
transmute(`Adjusted Quit Attempt`=round(`Adjusted Quit Attempt` * 100, 1),
lower_bound=round(lower_bound * 100, 1),
upper_bound=round(upper_bound * 100,1))
adjusted_attempt$concat <- paste(adjusted_attempt$`Adjusted Quit Attempt`, "(", adjusted_attempt$lower_bound, "-" , adjusted_attempt$upper_bound, ")")
adjusted_attempt <- adjusted_attempt %>%
select(`Adjusted Quit Attempt (%)` = concat)
tabulate <- cbind(unadjusted_attempt, adjusted_attempt)
}
#rewriting readjust function for attempt to quit
attempt_readjust_function <- function(dframe1, dframe2, a_var, label){
dframe1$CIGQTYR <- as.character(dframe1$CIGQTYR)
dframe1 <- dframe1 %>%
select({{a_var}}, CIGQTYR)
dframe1 <- na.omit(dframe1)
unadjusted_attempt <- dframe1%>%
group_by({{a_var}}, CIGQTYR)%>%
summarize(ATTEMPT_RATE = n())%>%
spread(CIGQTYR, ATTEMPT_RATE)%>%
mutate(`Unadjusted Quit Attempt` = round((`1`)/(`1` + `0`) * 100, 1))
unadjusted_attempt$prob <- unadjusted_attempt$`Unadjusted Quit Attempt`/100
unadjusted_attempt$n <- unadjusted_attempt$`1` + unadjusted_attempt$`0`
unadjusted_attempt$se <- sqrt((unadjusted_attempt$prob * (1-unadjusted_attempt$prob))/unadjusted_attempt$n)
unadjusted_attempt$lower <- round((unadjusted_attempt$prob - (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$upper <- round((unadjusted_attempt$prob + (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$`Unadjusted Quit Attempt (%)` <- paste(unadjusted_attempt$`Unadjusted Quit Attempt`,
"(", unadjusted_attempt$lower, "-", unadjusted_attempt$upper, ")")
unadjusted_attempt <- unadjusted_attempt%>%
select(`-`={{a_var}}, `Unadjusted Quit Attempt (%)`)
adjusted_attempt <- dframe2 %>%
group_by({{a_var}})%>%
summarize_at(vars(`Adjusted Quit Attempt`, lower_bound, upper_bound), mean)%>%
transmute(`Adjusted Quit Attempt`=round(`Adjusted Quit Attempt` * 100, 1),
lower_bound=round(lower_bound * 100, 1),
upper_bound=round(upper_bound * 100,1))
adjusted_attempt$concat <- paste(adjusted_attempt$`Adjusted Quit Attempt`, "(", adjusted_attempt$lower_bound, "-" , adjusted_attempt$upper_bound, ")")
adjusted_attempt <- adjusted_attempt %>%
select(`Adjusted Quit Attempt (%)` = concat)
tabulate <- cbind(unadjusted_attempt, adjusted_attempt)
}
#rewriting readjust function for attempt to quit
attempt_general_function <- function(dframe1, dframe2){
dframe1$CIGQTYR <- as.character(dframe1$CIGQTYR)
dframe1$General_Quit <- "Total"
dframe1 <- dframe1 %>%
select(General_Quit, CIGQTYR)
dframe1 <- na.omit(dframe1)
unadjusted_attempt <- dframe1%>%
group_by(General_Quit, CIGQTYR)%>%
summarize(ATTEMPT_RATE = n())%>%
spread(CIGQTYR, ATTEMPT_RATE)%>%
mutate(`Unadjusted Quit Attempt` = round((`1`)/(`1` + `0`) * 100, 1))
unadjusted_attempt$prob <- unadjusted_attempt$`Unadjusted Quit Attempt`/100
unadjusted_attempt$n <- unadjusted_attempt$`1` + unadjusted_attempt$`0`
unadjusted_attempt$se <- sqrt((unadjusted_attempt$prob * (1-unadjusted_attempt$prob))/unadjusted_attempt$n)
unadjusted_attempt$lower <- round((unadjusted_attempt$prob - (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$upper <- round((unadjusted_attempt$prob + (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$`Unadjusted Quit Attempt (%)` <- paste(unadjusted_attempt$`Unadjusted Quit Attempt`,
"(", unadjusted_attempt$lower, "-", unadjusted_attempt$upper, ")")
unadjusted_attempt <- unadjusted_attempt%>%
select(`-`=General_Quit, `Unadjusted Quit Attempt (%)`)
adjusted_attempt <- dframe2 %>%
summarize_at(vars(`Adjusted Quit Attempt`, lower_bound, upper_bound), mean)%>%
transmute(`Adjusted Quit Attempt`=round(`Adjusted Quit Attempt` * 100, 1),
lower_bound=round(lower_bound * 100, 1),
upper_bound=round(upper_bound * 100,1))
adjusted_attempt$concat <- paste(adjusted_attempt$`Adjusted Quit Attempt`, "(", adjusted_attempt$lower_bound, "-" , adjusted_attempt$upper_bound, ")")
adjusted_attempt <- adjusted_attempt %>%
select(`Adjusted Quit Attempt (%)` = concat)
tabulate <- cbind(unadjusted_attempt, adjusted_attempt)
}
general_quit <- attempt_general_function(attempt_to_quit, predicted_attempt_to_quit)
region <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, REGION)
age <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, AGE)
sex <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, SEX)
education <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, EDUCATION)
ratcat <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `INCOME RATIO TO FPL`)
mental_health <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `MENTAL HEALTH PROBLEM`)
race <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, RACE)
houseown <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, HOUSEOWN)
income <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `INCOME GROUP`)
food_sec <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `FOOD SECURITY`)
orient <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `SEXUAL ORIENTATION`)
coverage <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, COVERAGE)
adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Attempt to Quit Smoking", booktabs=T, align="lrr")%>%
pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
"Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
"Health insurance coverage"=5))%>%
kable_styling(latex_options=c("striped"), full_width=T, font_size = 10)%>%
footnote(number=c("95% confidence intervals are reported in parentheses"))
attempt_general_function <- function(dframe1, dframe2){
dframe1$CIGQTYR <- as.character(dframe1$CIGQTYR)
dframe1$General_Quit <- "Total"
dframe1 <- dframe1 %>%
select(General_Quit, CIGQTYR)
dframe1 <- na.omit(dframe1)
unadjusted_attempt <- dframe1%>%
group_by(General_Quit, CIGQTYR)%>%
summarize(ATTEMPT_RATE = n())%>%
spread(CIGQTYR, ATTEMPT_RATE)%>%
mutate(`Unadjusted Quit Attempt` = round((`1`)/(`1` + `0`) * 100, 1))
unadjusted_attempt$prob <- unadjusted_attempt$`Unadjusted Quit Attempt`/100
unadjusted_attempt$n <- unadjusted_attempt$`1` + unadjusted_attempt$`0`
unadjusted_attempt$se <- sqrt((unadjusted_attempt$prob * (1-unadjusted_attempt$prob))/unadjusted_attempt$n)
unadjusted_attempt$lower <- round((unadjusted_attempt$prob - (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$upper <- round((unadjusted_attempt$prob + (qnorm(0.975) * unadjusted_attempt$se)) * 100, 1)
unadjusted_attempt$`Unadjusted Quit Attempt (%)` <- paste(unadjusted_attempt$`Unadjusted Quit Attempt`,
"(", unadjusted_attempt$lower, "-", unadjusted_attempt$upper, ")")
unadjusted_attempt <- unadjusted_attempt%>%
select(`-`=General_Quit, `Unadjusted Quit Attempt (%)`)
adjusted_attempt <- dframe2 %>%
summarize_at(vars(`Adjusted Quit Attempt`, lower_bound, upper_bound), mean)%>%
transmute(`Adjusted Quit Attempt`=round(`Adjusted Quit Attempt` * 100, 1),
lower_bound=round(lower_bound * 100, 1),
upper_bound=round(upper_bound * 100,1))
adjusted_attempt$concat <- paste(adjusted_attempt$`Adjusted Quit Attempt`, "(", adjusted_attempt$lower_bound, "-" , adjusted_attempt$upper_bound, ")")
adjusted_attempt <- adjusted_attempt %>%
select(`Adjusted Quit Attempt (%)` = concat)
tabulate <- cbind(unadjusted_attempt, adjusted_attempt)
}
general_quit <- attempt_general_function(attempt_to_quit, predicted_attempt_to_quit)
region <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, REGION)
age <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, AGE)
sex <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, SEX)
education <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, EDUCATION)
ratcat <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `INCOME RATIO TO FPL`)
mental_health <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `MENTAL HEALTH PROBLEM`)
race <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, RACE)
houseown <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, HOUSEOWN)
income <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `INCOME GROUP`)
food_sec <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `FOOD SECURITY`)
orient <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, `SEXUAL ORIENTATION`)
coverage <- attempt_readjust_function(attempt_to_quit, predicted_attempt_to_quit, COVERAGE)
adjust_table <- rbind(general_quit, region, age, sex, education, ratcat, mental_health, race, houseown, income, food_sec, orient, coverage)
kable(adjust_table, caption = "Adjusted and Unadjusted Quit Rates for Attempt to Quit Smoking", booktabs=T, align="lrr")%>%
pack_rows(index=c(" " = 1, "Region"= 4, "Age"=3, "Sex"=2, "Education"=4, "Ratio of Income to FPL"=4, "Mental health problem"=2,
"Race"=3, "Home Ownership"=2, "Income Group"=4, "Food Security"=2, "Sexual Orientation"=2,
"Health insurance coverage"=5))%>%
kable_styling(latex_options=c("striped"), full_width=T, font_size = 10)%>%
footnote(number=c("95% confidence intervals are reported in parentheses"))
setwd("C:/Users/amodu/OneDrive/Desktop/American Cancer Society/Merge and Analysis/2018_log_regression_analysis")
install.packages("kableExtra")
